<!DOCTYPE html>
<html lang="en" class="semi-dark">
  <head>
    <%- include("partials/metaHead") %>
    <title>Register Reddit - TDSoft</title>
  </head>

  <body>
    <!--start wrapper-->
    <div class="wrapper">
      <%- include("partials/topHeader") %> <%- include("partials/sidebarNav") %>

      <!--start content-->
      <main class="page-content">
        <!-- START Export-->
        <div class="card radius-10 shadow-sm w-100">
          <div class="card-header">
            <h5 class="mb-0">Export</h5>
          </div>
          <div class="card-body">
            <form action="/accounts/export" method="POST">
              <div class="mb-3">
                <label for="fromDate" class="form-label">From</label>
                <input
                  required
                  type="date"
                  class="form-control"
                  name="fromDate"
                  id="fromDate"
                />
              </div>
              <div class="mb-3">
                <label for="toDate" class="form-label">To</label>
                <input
                  required
                  type="date"
                  class="form-control"
                  name="toDate"
                  id="toDate"
                />
              </div>
              <div class="mb-3">
                <label for="verification" class="form-label"
                  >Verification</label
                >
                <select name="verification" class="form-select">
                  <option value="all">All</option>
                  <option value="no">No</option>
                  <option value="mailVerified">Mail Verified</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select name="status" class="form-select">
                  <option value="all">All</option>
                  <option value="live">Live</option>
                  <option value="died">Died</option>
                </select>
              </div>
              <button class="btn btn-primary px-5" type="submit">Export</button>
            </form>
          </div>
        </div>
        <!-- END Export-->

        <!-- START Accounts -->
        <div class="card radius-10 shadow-sm w-100">
          <div class="card-header">
            <div class="row justify-content-between align-items-center">
              <div class="col">
                <h5 class="mb-0">Accounts</h5>
              </div>
              <div class="col text-end">
                <span id="lastChecked"></span>
                <a
                  href="/check/start"
                  id="banCheckBtn"
                  class="btn btn-primary px-3"
                >
                  Check
                </a>
                <a
                  href="/check/stop"
                  id="stopBtn"
                  class="btn btn-danger px-3 disabled"
                  >Stop</a
                >
              </div>
            </div>
          </div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Username</th>
                  <!-- <th>Password</th> -->
                  <th>Email</th>
                  <!-- <th>Passmail</th> -->
                  <th>Verification</th>
                  <th>IP</th>
                  <th>Created Date</th>
                  <th>ProfileId</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <% for (account of accounts) { %>
                <tr>
                  <td><%= account.username %></td>
                  <!-- <td><%= account.password %></td> -->
                  <td><%= account.email %></td>
                  <!-- <td><%= account.passmail %></td> -->
                  <td><%= account.verification %></td>
                  <td><%= account.IP %></td>
                  <td><%= account.createdDate.toLocaleString() %></td>
                  <td><%= account.profileId %></td>
                  <td>
                    <span
                      class="badge <%= account.status ? 'bg-success' : 'bg-danger' %>"
                      ><%= account.status ? 'Live' : 'Died' %></span
                    >
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
            <!-- START Pagination -->
            <nav class="mt-3">
              <ul class="pagination round-pagination">
                <li
                  class="page-item <%= currentPage === 1 ? 'disabled' : '' %>"
                >
                  <a
                    href="/accounts?page=<%= currentPage - 1 %>"
                    class="page-link"
                    ><span aria-hidden="true">«</span></a
                  >
                </li>
                <% for (let i = 1; i <= totalPages; i++) { %>
                <li class="page-item <%= currentPage === i ? 'active' : ''%>">
                  <a href="/accounts?page=<%= i %>" class="page-link"
                    ><%= i %></a
                  >
                </li>
                <% } %>

                <li
                  class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>"
                >
                  <a
                    href="/accounts?page=<%= currentPage + 1 %>"
                    class="page-link"
                    ><span aria-hidden="true">»</span></a
                  >
                </li>
              </ul>
              <span>Total: <%= totalItems %> accounts</span>
            </nav>
            <!-- END Pagination -->
          </div>
        </div>
        <!-- END Accounts-->
      </main>
      <!--end page main-->

      <!--start overlay-->
      <div class="overlay nav-toggle-icon"></div>
      <!--end overlay-->

      <!--Start Back To Top Button-->
      <a href="javaScript:;" class="back-to-top"
        ><i class="bx bxs-up-arrow-alt"></i
      ></a>
      <!--End Back To Top Button-->
    </div>
    <!--end wrapper-->

    <%- include("partials/jsLib") %>

    <!-- Ban Check -->
    <script>
      function loadBanCheck() {
        $.ajax({
          url: "/check/status",
          success: (result) => {
            if (result.running) {
              $("#stopBtn").removeClass("disabled");
              $("#banCheckBtn").attr("disabled", "");
              outputHTML =
                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ';
              outputHTML += result.checked + "/" + result.total;
              $("#banCheckBtn").html(outputHTML);
              // bla bla
            } else {
              $("#stopBtn").addClass("disabled");
              $("#lastChecked").text(
                "Last checked: " + result.lastChecked.toLocaleString()
              );
              $("#banCheckBtn").removeAttr("disabled");
              $("#banCheckBtn").html("Check");
            }
          },
        });
      }
      setInterval(loadBanCheck, 2000);
    </script>
  </body>
</html>
